<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Activiti7 绘制流程图，流程的部署，查询以及删除"><meta name="keywords" content="activiti"><meta name="author" content="winily,18934086807@163.com"><meta name="copyright" content="winily"><title>Activiti7 绘制流程图，流程的部署，查询以及删除 | winily</title><link rel="shortcut icon" href="/winily.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Activiti7-绘制流程图，流程的部署，查询以及删除"><span class="toc-number">1.</span> <span class="toc-text">Activiti7 绘制流程图，流程的部署，查询以及删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NO：2020-0x02"><span class="toc-number">1.1.</span> <span class="toc-text">NO：2020-0x02</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#惯例前言"><span class="toc-number">1.2.</span> <span class="toc-text">惯例前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#绘制流程图"><span class="toc-number">1.3.</span> <span class="toc-text">绘制流程图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署流程"><span class="toc-number">1.4.</span> <span class="toc-text">部署流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#书写接口"><span class="toc-number">1.4.1.</span> <span class="toc-text">书写接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#流程部署"><span class="toc-number">1.4.2.</span> <span class="toc-text">流程部署</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询流程"><span class="toc-number">1.5.</span> <span class="toc-text">查询流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分页查询"><span class="toc-number">1.5.1.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#详情查询"><span class="toc-number">1.5.2.</span> <span class="toc-text">详情查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除流程定义"><span class="toc-number">1.6.</span> <span class="toc-text">删除流程定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#唠叨"><span class="toc-number">1.7.</span> <span class="toc-text">唠叨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下章计划"><span class="toc-number">1.8.</span> <span class="toc-text">下章计划</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://blog-cdn.li-winily.com/head.jpg"></div><div class="author-info__name text-center">winily</div><div class="author-info__description text-center">Node Java 前端各种探索代码的程序员。</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">5</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">2</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://blog-cdn.li-winily.com/blog%2Fimgblog-bg.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">winily</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Activiti7 绘制流程图，流程的部署，查询以及删除</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-13</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="Activiti7-绘制流程图，流程的部署，查询以及删除"><a href="#Activiti7-绘制流程图，流程的部署，查询以及删除" class="headerlink" title="Activiti7 绘制流程图，流程的部署，查询以及删除"></a><center>Activiti7 绘制流程图，流程的部署，查询以及删除<center></h2><h3 id="NO：2020-0x02"><a href="#NO：2020-0x02" class="headerlink" title="NO：2020-0x02"></a>NO：2020-0x02</h3><h3 id="惯例前言"><a href="#惯例前言" class="headerlink" title="惯例前言"></a>惯例前言</h3><p>上篇地址</p>
<p><a href="https://juejin.im/post/5e899bb0518825739728646a" target="_blank" rel="noopener">Spring Boot 整合 Activiti7</a></p>
<p>&emsp;&emsp;前文再续,书接上一回~~ 其实按照计划上来说我是昨天就应该发了这篇文章的，但是中途遇到了点意料之外的事情导致计划延迟了。至于是发生了什么意料之外的事情，嗯没错刷抖音真爽。</p>
<center><img src="https://user-gold-cdn.xitu.io/2020/4/13/17173d43410b07e5?w=322&h=220&f=gif&s=466620"></center>

<p>&emsp;&emsp;好吧其实就是我偷懒了，反应过来的时候已经晚上十一点多了，后来就先写好了要用到的代码上传了今天才来写上文章。</p>
<center>Github 完整代码<a href="https://github.com/winily/activiti-seed" target="_blank" rel="noopener"> Activiti-seed </a>作者博客<a href="http://blog.li-winily.com/" target="_blank" rel="noopener"> Winily-blog</a></center>

<p>今天主要想说的重点有</p>
<ol>
<li>流程的部署</li>
<li>流程的查询：分页查询以及查询单个详情</li>
<li>删除流程</li>
</ol>
<p>本篇章<a href="https://github.com/winily/activiti-seed/tree/2020-0x02" target="_blank" rel="noopener">源码地址</a> !!! 建议下载源码边看文章边对比源码，在这里篇幅有限不会贴上所有的代码。</p>
<p>在这次的我在代码中写好了接口以及实体类，这部分 Spring Boot 的操作我就不讲了去看源码吧，我相信你们看的懂的，看不懂就给我留言吧。接下来开始吧！</p>
<h3 id="绘制流程图"><a href="#绘制流程图" class="headerlink" title="绘制流程图"></a>绘制流程图</h3><p>&emsp;&emsp;流程图的绘制的话其实在 Activiti 以前的老版本中是有提供一个嵌入后端的流程编辑器的，但是现在的新版本把流程编辑器从中剥离了出来，成为了一个单独的项目，是用 Angular 写的，刚好我不怎么会用 Angular 所以就换了一个折腾，使用了 Vue + Bpmn.js 搭建了一个流程编辑器，有需要的可以去看我另外两篇文章，下载我的<a href="https://github.com/winily/bpmn-demo" target="_blank" rel="noopener">源码</a>下来运行即可使用。</p>
<p><a href="https://juejin.im/post/5e802afcf265da794978f8b0" target="_blank" rel="noopener">Bpmn.js 在线流程编辑器的汉化</a></p>
<p><a href="https://juejin.im/post/5e509fab6fb9a07c820fa78a" target="_blank" rel="noopener">Vue 整合 Bpmn-js 工作流模型编辑器</a></p>
<p>接下来开始画流程图随便画一个流程图然后下载流程文件到本地，因为这个篇章不会涉及到流程任务的办理所以随便个流程文件可以部署就好。</p>
<center><img src="https://user-gold-cdn.xitu.io/2020/4/13/17174020fbc0de9b?w=1920&h=947&f=png&s=121020"></center>

<p>&emsp;&emsp;流程图画好了就下载下来， 在项目的 resources 下新建一个 bpmn 的文件夹来存放刚刚画好的 bpmn 文件，当然你要是想要把这个文件夹命名别的名称也没啥。</p>
<h3 id="部署流程"><a href="#部署流程" class="headerlink" title="部署流程"></a>部署流程</h3><p>&emsp;&emsp;接下来来进行部署流程的操作，部署流程有很多方法，我这里案例中重点讲通过 addInputStream 的方式进行部署，因为在实际项目中我觉得这个更贴切实际。部署流程的方法基本有以下几种</p>
<ol>
<li>addInputStream 通过输入流部署</li>
<li>addString 通过字符串部署</li>
<li>addClasspathResource 通过文件路径读取流程文件部署</li>
<li>addZipInputStream 通过压缩包输入流部署</li>
</ol>
<h4 id="书写接口"><a href="#书写接口" class="headerlink" title="书写接口"></a>书写接口</h4><p>&emsp;&emsp;我直接按照实际开发来写接口的方式来了，感觉这样子更贴近实际项目，所以就不简单的写 test 来讲解了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line"> * <span class="meta">@author</span> winily</span><br><span class="line"> * <span class="meta">@date</span> <span class="number">2020</span>/<span class="number">4</span>/<span class="number">5</span></span><br><span class="line"> */</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/activiti/deployment"</span>)</span><br><span class="line"><span class="meta">@Api</span>(tags = <span class="string">"流程管理"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActProcessController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ActProcessService actProcessService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"部署流程"</span>)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 该接口接收一个对象对象里面包括了文件，名称等字段</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">deploy</span><span class="params">(@ModelAttribute ProcessDeploymentDTO processDeploymentDTO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用 service 进行部署流程操作</span></span><br><span class="line">        ProcessDeploymentDTO result = <span class="keyword">this</span>.actProcessService.deploy(processDeploymentDTO);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result&lt;ProcessDeploymentDTO&gt;().ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> winily</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessDeploymentDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// 流程文件</span></span><br><span class="line">    <span class="keyword">private</span> MultipartFile file;</span><br><span class="line">    <span class="keyword">private</span> String category;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Date deploymentTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProcessDeploymentDTO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造方法，将 Activiti 原生的 Deployment 转换为 TDO 对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProcessDeploymentDTO</span><span class="params">(Deployment deployment)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setId(deployment.getId());</span><br><span class="line">        <span class="keyword">this</span>.setName(deployment.getName());</span><br><span class="line">        <span class="keyword">this</span>.setCategory(deployment.getCategory());</span><br><span class="line">        <span class="keyword">this</span>.setKey(deployment.getKey());</span><br><span class="line">        <span class="keyword">this</span>.setDeploymentTime(deployment.getDeploymentTime());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="流程部署"><a href="#流程部署" class="headerlink" title="流程部署"></a>流程部署</h4><p>&emsp;&emsp;接下来开始部署流程，这里使用的是第一种 通过输入流进行部署，其他的部署方式我写在了 Test 上可以去看看。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> winily</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/4/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActProcessServiceImpl</span> <span class="keyword">implements</span> <span class="title">ActProcessService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 在Service 中注入 Activiti 的 RepositoryService</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RepositoryService repositoryService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ActProcessServiceImpl</span><span class="params">(RepositoryService repositoryService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.repositoryService = repositoryService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProcessDeploymentDTO <span class="title">deploy</span><span class="params">(ProcessDeploymentDTO processDeploymentDTO)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 部署流程后回返回对应部署成功的流程定义对象</span></span><br><span class="line">            <span class="comment">// 通过 RepositoryService 创建一个流程定义</span></span><br><span class="line">            Deployment deployment = <span class="keyword">this</span>.repositoryService.createDeployment()</span><br><span class="line">                    <span class="comment">// 设置流程定义名称</span></span><br><span class="line">                    .name(processDeploymentDTO.getName())</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 添加输入流，两个参数</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">@param</span> name 第一个参数是设置流程定义文件的名称</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">@param</span> inputStream 第二个参数输入流，从提交的文件中获取输入流，读取到上传的文件数据</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    .addInputStream(processDeploymentDTO.getFile().getOriginalFilename(), <span class="comment">// 获取文件名</span></span><br><span class="line">                    processDeploymentDTO.getFile().getInputStream()) <span class="comment">// 从文件中获取输入流</span></span><br><span class="line">                    <span class="comment">// 流程定义的类别</span></span><br><span class="line">                    .category(processDeploymentDTO.getCategory())</span><br><span class="line">                    <span class="comment">// 流程定义的key</span></span><br><span class="line">                    .key(processDeploymentDTO.getKey())</span><br><span class="line">                    <span class="comment">// 执行部署</span></span><br><span class="line">                    .deploy();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ProcessDeploymentDTO(deployment);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是使用流程进行流程部署，部署成功后会在 ACT_RE_DEPLOYMENT 表中新增一条数据，这个就是流程定义的数据了。</p>
<p>其他部署方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deployByString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 流程代码</span></span><br><span class="line">    String bpmn = <span class="string">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span> +</span><br><span class="line">            <span class="string">"&lt;definitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:camunda=\"http://camunda.org/schema/1.0/bpmn\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:activiti=\"http://activiti.org/bpmn\" id=\"m1577635100724\" name=\"\" targetNamespace=\"http://www.activiti.org/testm1577635100724\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"  &lt;process id=\"demoByString\" name=\"DemoByString\" processType=\"None\" isClosed=\"false\" isExecutable=\"true\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;extensionElements&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;camunda:properties&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;camunda:property name=\"a\" value=\"1\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/camunda:properties&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;/extensionElements&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;startEvent id=\"_2\" name=\"start\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;outgoing&gt;SequenceFlow_06ecyje&lt;/outgoing&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;/startEvent&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;task id=\"Task_0xns2h7\" name=\"task1\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;incoming&gt;SequenceFlow_06ecyje&lt;/incoming&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;outgoing&gt;SequenceFlow_0gfpxr6&lt;/outgoing&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;/task&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;sequenceFlow id=\"SequenceFlow_06ecyje\" sourceRef=\"_2\" targetRef=\"Task_0xns2h7\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;task id=\"Task_1rmrosm\" name=\"task2\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;incoming&gt;SequenceFlow_0gfpxr6&lt;/incoming&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;outgoing&gt;SequenceFlow_11xfslc&lt;/outgoing&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;/task&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;sequenceFlow id=\"SequenceFlow_0gfpxr6\" sourceRef=\"Task_0xns2h7\" targetRef=\"Task_1rmrosm\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;endEvent id=\"EndEvent_0nt66s0\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;incoming&gt;SequenceFlow_11xfslc&lt;/incoming&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;/endEvent&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;sequenceFlow id=\"SequenceFlow_11xfslc\" sourceRef=\"Task_1rmrosm\" targetRef=\"EndEvent_0nt66s0\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"  &lt;/process&gt;\n"</span> +</span><br><span class="line">            <span class="string">"  &lt;bpmndi:BPMNDiagram id=\"BPMNDiagram_leave\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;bpmndi:BPMNPlane id=\"BPMNPlane_leave\" bpmnElement=\"demo1\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;bpmndi:BPMNShape id=\"BPMNShape__2\" bpmnElement=\"_2\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;omgdc:Bounds x=\"144\" y=\"368\" width=\"32\" height=\"32\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;bpmndi:BPMNLabel&gt;\n"</span> +</span><br><span class="line">            <span class="string">"          &lt;omgdc:Bounds x=\"149\" y=\"400\" width=\"23\" height=\"14\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;/bpmndi:BPMNLabel&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/bpmndi:BPMNShape&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;bpmndi:BPMNShape id=\"Task_0xns2h7_di\" bpmnElement=\"Task_0xns2h7\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;omgdc:Bounds x=\"230\" y=\"344\" width=\"100\" height=\"80\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/bpmndi:BPMNShape&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;bpmndi:BPMNEdge id=\"SequenceFlow_06ecyje_di\" bpmnElement=\"SequenceFlow_06ecyje\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;di:waypoint x=\"176\" y=\"384\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;di:waypoint x=\"230\" y=\"384\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/bpmndi:BPMNEdge&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;bpmndi:BPMNShape id=\"Task_1rmrosm_di\" bpmnElement=\"Task_1rmrosm\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;omgdc:Bounds x=\"390\" y=\"344\" width=\"100\" height=\"80\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/bpmndi:BPMNShape&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;bpmndi:BPMNEdge id=\"SequenceFlow_0gfpxr6_di\" bpmnElement=\"SequenceFlow_0gfpxr6\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;di:waypoint x=\"330\" y=\"384\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;di:waypoint x=\"390\" y=\"384\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/bpmndi:BPMNEdge&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;bpmndi:BPMNShape id=\"EndEvent_0nt66s0_di\" bpmnElement=\"EndEvent_0nt66s0\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;omgdc:Bounds x=\"552\" y=\"366\" width=\"36\" height=\"36\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/bpmndi:BPMNShape&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;bpmndi:BPMNEdge id=\"SequenceFlow_11xfslc_di\" bpmnElement=\"SequenceFlow_11xfslc\"&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;di:waypoint x=\"490\" y=\"384\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"        &lt;di:waypoint x=\"552\" y=\"384\" /&gt;\n"</span> +</span><br><span class="line">            <span class="string">"      &lt;/bpmndi:BPMNEdge&gt;\n"</span> +</span><br><span class="line">            <span class="string">"    &lt;/bpmndi:BPMNPlane&gt;\n"</span> +</span><br><span class="line">            <span class="string">"  &lt;/bpmndi:BPMNDiagram&gt;\n"</span> +</span><br><span class="line">            <span class="string">"&lt;/definitions&gt;\n"</span>;</span><br><span class="line">    <span class="comment">// 这里基本跟第一个的 输入流部署差不多只是使用了 addString 来设置流程</span></span><br><span class="line">    <span class="keyword">this</span>.repositoryService.createDeployment()</span><br><span class="line">            .name(<span class="string">"demoByString"</span>)</span><br><span class="line">            <span class="comment">// 将流程代码以 String 方式载入流程定义</span></span><br><span class="line">            .addString(<span class="string">"demoByString"</span>, bpmn)</span><br><span class="line">            .category(<span class="string">"demo"</span>)</span><br><span class="line">            .key(<span class="string">"demoByString"</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deployByClasspath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.repositoryService.createDeployment()</span><br><span class="line">            <span class="comment">// 通过 classpath 获取流程文件地址读取文件载入流程定义</span></span><br><span class="line">            .addClasspathResource(<span class="string">"bpmn/demo1.bpmn"</span>)</span><br><span class="line">            .name(<span class="string">"demoByClasspath"</span>)</span><br><span class="line">            .key(<span class="string">"demoByClasspath"</span>)</span><br><span class="line">            .category(<span class="string">"demo"</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deployByZip</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    InputStream in = <span class="keyword">this</span>.getClass().getClassLoader().getSystemResourceAsStream(<span class="string">"bpmn/demo1.zip"</span>);</span><br><span class="line">    ZipInputStream zipInputStream = <span class="keyword">new</span> ZipInputStream(in);</span><br><span class="line">    <span class="keyword">this</span>.repositoryService.createDeployment()</span><br><span class="line">            .name(<span class="string">"deployByZip"</span>)</span><br><span class="line">            .key(<span class="string">"deployByZip"</span>)</span><br><span class="line">            .category(<span class="string">"demo"</span>)</span><br><span class="line">            <span class="comment">// 通过 zip 压缩包输入流进行载入流程定义</span></span><br><span class="line">            .addZipInputStream(zipInputStream)</span><br><span class="line">            .deploy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询流程"><a href="#查询流程" class="headerlink" title="查询流程"></a>查询流程</h3><p>&emsp;&emsp;接下来讲讲如何查询流程，其实也很简单，通过链式掉用来组成条件设置排序以及筛选操作。</p>
<h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ProcessDeploymentDTO&gt; <span class="title">list</span><span class="params">(Integer page, Integer size, Integer order)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取查询流程定义对对象</span></span><br><span class="line">    DeploymentQuery deploymentQuery = <span class="keyword">this</span>.repositoryService.createDeploymentQuery()</span><br><span class="line">            <span class="comment">// 根据流程定义部署时间排序</span></span><br><span class="line">            .orderByDeploymenTime();</span><br><span class="line">    <span class="keyword">if</span> (order == <span class="keyword">null</span> || order == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 升序</span></span><br><span class="line">        deploymentQuery.asc();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 降序</span></span><br><span class="line">        deploymentQuery.desc();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从第几条开始</span></span><br><span class="line">    <span class="keyword">int</span> start = (page * size) - size + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 到第几条结束</span></span><br><span class="line">    <span class="keyword">int</span> end = page * size;</span><br><span class="line">    <span class="comment">// 根据上面的数据进行分页查询出列表</span></span><br><span class="line">    <span class="comment">// 调用 listPage 会返回分页数据如果调用list的话就会返回所有的数据</span></span><br><span class="line">    List&lt;Deployment&gt; deployments = deploymentQuery.listPage(start, end);</span><br><span class="line">    List&lt;ProcessDeploymentDTO&gt; processDeploymentDTOList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// 将 原生的 Deployment 转换为 ProcessDeploymentDTO</span></span><br><span class="line">    deployments.forEach(it -&gt; &#123;</span><br><span class="line">        processDeploymentDTOList.add(<span class="keyword">new</span> ProcessDeploymentDTO(it));</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> processDeploymentDTOList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="详情查询"><a href="#详情查询" class="headerlink" title="详情查询"></a>详情查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ProcessDeploymentDTO <span class="title">info</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    Deployment deployment = <span class="keyword">this</span>.repositoryService</span><br><span class="line">            <span class="comment">// 创建流程定义查询器</span></span><br><span class="line">            .createDeploymentQuery()</span><br><span class="line">            <span class="comment">// 添加流程定义 id 条件</span></span><br><span class="line">            .deploymentId(id)</span><br><span class="line">            <span class="comment">// 返回单条数据</span></span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ProcessDeploymentDTO(deployment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除流程定义"><a href="#删除流程定义" class="headerlink" title="删除流程定义"></a>删除流程定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">destroy</span><span class="params">(String deploymentId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 第一参数为流程定义id</span></span><br><span class="line"><span class="comment">         * 第二参数为是否联级删除流程定义</span></span><br><span class="line"><span class="comment">         * 如果第二参数为true的话所有有关这个流程定义的数据都会被删除</span></span><br><span class="line"><span class="comment">         * this.repositoryService.deleteDeployment(deploymentId, true);</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 输入流程定义删除流程, 若该流程有正常运行的流程或者记录，会删除失败</span></span><br><span class="line">        <span class="keyword">this</span>.repositoryService.deleteDeployment(deploymentId);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result().error();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result().ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="唠叨"><a href="#唠叨" class="headerlink" title="唠叨"></a>唠叨</h3><p>&emsp;&emsp;在这个篇章我写着写着不知道要写什么好了，因为后面的操作我基本在代码中写好了注释，我自我感觉不难都是比较简单的操作，所以就没有写上其他的段落来讲解了。要是看不懂欢迎给我留言我看到会第一时间进行回复回答。</p>
<h3 id="下章计划"><a href="#下章计划" class="headerlink" title="下章计划"></a>下章计划</h3><p>&emsp;&emsp;本章节就先到此为止了，下一章节，流程的发起、查询、挂起、激活以及删除。欲知后事如何请听下回分解！</p>
<center><img src="https://user-gold-cdn.xitu.io/2020/4/13/1717435dbd78cc53?w=500&h=501&f=jpeg&s=21315"></center>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:18934086807@163.com" target="_blank" rel="noopener">winily</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://winily.github.io/2020/04/13/activiti-deployment/">https://winily.github.io/2020/04/13/activiti-deployment/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/activiti/">activiti</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2020/04/05/activiti-start/"><span>Spring Boot 整合 Activiti7</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://blog-cdn.li-winily.com/blog%2Fimgblog-bg.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2020 By winily</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text"><img style="border:none;padding:0;" src="http://blog-cdn.li-winily.com/icp.png"><a href="http://www.beian.miit.gov.cn/"  style="margin-left:10px; color:#f72b07" target="_blank">粤ICP备20008853号</a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>